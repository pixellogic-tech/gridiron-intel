import React,{createContext,useContext,useState,useEffect}from'react';import axios from'axios';const API='http://localhost:5000/api';const AC=createContext<any>(undefined);export const AuthProvider=({children}:{children:React.ReactNode})=>{const[u,sU]=useState(null);const[t,sT]=useState(null);const[l,sL]=useState(true);useEffect(()=>{const tk=localStorage.getItem('gi_token');const ur=localStorage.getItem('gi_user');if(tk&&ur){sT(tk);sU(JSON.parse(ur))}sL(false)},[]);const login=async(e:string,p:string)=>{const{data}=await axios.post(`${API}/auth/login`,{email:e,password:p});localStorage.setItem('gi_token',data.token);localStorage.setItem('gi_user',JSON.stringify(data.user));sT(data.token);sU(data.user)};const logout=()=>{localStorage.clear();sT(null);sU(null)};return<AC.Provider value={{user:u,token:t,login,logout,isLoading:l}}>{children}</AC.Provider>};export const useAuth=()=>{const c=useContext(AC);if(!c)throw new Error('useAuth must be in AuthProvider');return c};
